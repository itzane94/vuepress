<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PHP的openssl加密扩展使用 | zane&#39;s blog</title>
    <meta name="description" content="PHP的openssl加密扩展使用">
    <link rel="icon" href="/favicon.ico">
    <meta name="keywords" content="PHP的openssl加密扩展使用">
    <link rel="preload" href="/assets/css/0.styles.9c18e3b9.css" as="style"><link rel="preload" href="/assets/js/app.5f87c6e8.js" as="script"><link rel="preload" href="/assets/js/8.85014434.js" as="script"><link rel="prefetch" href="/assets/js/2.6fc8154e.js"><link rel="prefetch" href="/assets/js/3.07762fc5.js"><link rel="prefetch" href="/assets/js/4.71579af1.js"><link rel="prefetch" href="/assets/js/5.0a635dda.js"><link rel="prefetch" href="/assets/js/6.1742b4bc.js"><link rel="prefetch" href="/assets/js/7.484365db.js"><link rel="prefetch" href="/assets/js/9.aa5a49dd.js"><link rel="prefetch" href="/assets/js/10.45a59d6f.js"><link rel="prefetch" href="/assets/js/11.7131e4cf.js"><link rel="prefetch" href="/assets/js/12.2032e30a.js"><link rel="prefetch" href="/assets/js/13.2935f7b1.js"><link rel="prefetch" href="/assets/js/14.06bc1268.js"><link rel="prefetch" href="/assets/js/15.932d2cc6.js"><link rel="prefetch" href="/assets/js/16.d34d6734.js"><link rel="prefetch" href="/assets/js/17.3532124f.js"><link rel="prefetch" href="/assets/js/18.e9142654.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9c18e3b9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="wrap"><div class="theme-container container no-sidebar"><header class="navbar"><div class="nav-header"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" class="logo"> <span class="site-name can-hide">
        zane's blog
      </span></a> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">BLOG</a></div><div class="nav-item"><a href="/tags/" class="nav-link">TAGS</a></div><div class="nav-item"><a href="https://github.com/itzane94" target="_blank" rel="noopener noreferrer" class="nav-link">GITHUB</a></div><div class="nav-item"><a href="https://music.163.com/#/user/home?id=300577130" target="_blank" rel="noopener noreferrer" class="nav-link">网易云</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于我</a></div> <!----></nav> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">BLOG</a></div><div class="nav-item"><a href="/tags/" class="nav-link">TAGS</a></div><div class="nav-item"><a href="https://github.com/itzane94" target="_blank" rel="noopener noreferrer" class="nav-link">GITHUB</a></div><div class="nav-item"><a href="https://music.163.com/#/user/home?id=300577130" target="_blank" rel="noopener noreferrer" class="nav-link">网易云</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于我</a></div> <!----></nav> <!----></div> <div class="page-container"><div><div class="page card"><div class="content-header"><h1 class="page-title" style="color:#ac3e40;">
        PHP的openssl加密扩展使用
      </h1> <span class="page-timestamp">2018-08-31 23:34:15</span></div> <div class="content"><h2 id="引言"><a href="#引言" aria-hidden="true" class="header-anchor">#</a> 引言</h2> <p>互联网的发展史上，安全性一直是开发者们相当重视的一个主题，为了实现数据传输安全，我们需要保证：数据来源（非伪造请求）、数据完整性（没有被人修改过）、数据私密性（密文，无法直接读取）等。虽然现在已经有SSL/TLS协议实现的HTTPS协议，但是因在客户端上依赖浏览器的正确实现，而且效率又很低，所以一般的敏感数据（如交易支付信息等）还是需要我们使用加密方法来手动加密。</p> <p>虽然对于一般的WEB开发人员来说，大可不必深入了解一些安全相关的底层技术，但学习加密基础知识，使用现有加密相关工具却十分必要。由于工作需要，自己看了些加密相关文章，结合自己的使用经历，完成此文。 学习如何使用加密之前，我们需要了解一些加密相关的基础知识。</p> <h2 id="加密基础"><a href="#加密基础" aria-hidden="true" class="header-anchor">#</a> 加密基础</h2> <p>加密算法一般分为两种：对称加密算法和非对称加密算法。</p> <ol><li>对称加密
对称加密算法是消息发送者和接收者使用同一个密匙，发送者使用密匙加密了文件，接收者使用同样的密匙解密，获取信息。常见的对称加密算法有：des/aes/3des.</li></ol> <p>对称加密算法的特点有：速度快，加密前后文件大小变化不大，但是密匙的保管是个大问题，因为消息发送方和接收方任意一方的密匙丢失，都会导致信息传输变得不安全。
2. 非对称加密
与对称加密相对的是非对称加密，非对称加密的核心思想是使用一对相对的密匙，分为公匙和私匙，私匙自己安全保存，而将公匙公开。公钥与私钥是一对，如果用公钥对数据进行加密，只有用对应的私钥才能解密；如果用私钥对数据进行加密，那么只有用对应的公钥才能解密。发送数据前只需要使用接收方的公匙加密就行了。常见的非对称加密算法有RSA/DSA:</p> <p>非对称加密虽然没有密匙保存问题，但其计算量大，加密速度很慢,有时候我们还需要对大块数据进行分块加密。
3. 数字签名
为了保证数据的完整性，还需要通过散列函数计算得到一个散列值，这个散列值被称为数字签名。其特点有：</p> <ul><li>无论原始数据是多大，结果的长度相同的；</li> <li>输入一样，输出也相同；</li> <li>对输入的微小改变，会使结果产生很大的变化；</li> <li>加密过程不可逆，无法通过散列值得到原来的数据；</li> <li>常见的数字签名算法有md5,hash1等算法。</li></ul> <h2 id="php的openssl扩展"><a href="#php的openssl扩展" aria-hidden="true" class="header-anchor">#</a> PHP的openssl扩展</h2> <p>openssl扩展使用openssl加密扩展包，封装了多个用于加密解密相关的PHP函数，极大地方便了对数据的加密解密。 常用的函数有：</p> <ol><li>对称加密相关：</li></ol> <blockquote><p>string openssl_encrypt ( string $data , string $method , string $password)
其中$data为其要加密的数据，$method是加密要使用的方法，$password是要使用的密匙，函数返回加密后的数据；
其中$method列表可以使用openssl_get_cipher_methods()来获取，我们选取其中一个使用，$method列表形如：</p></blockquote> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">Array</span><span class="token punctuation">(</span>
    <span class="token number">0</span> <span class="token operator">=</span><span class="token operator">&gt;</span> aes<span class="token operator">-</span><span class="token number">128</span><span class="token operator">-</span>cbc<span class="token punctuation">,</span>   <span class="token comment">// aes加密</span>
    <span class="token number">1</span> <span class="token operator">=</span><span class="token operator">&gt;</span> des<span class="token operator">-</span>ecb<span class="token punctuation">,</span>       <span class="token comment">// des加密</span>
    <span class="token number">2</span> <span class="token operator">=</span><span class="token operator">&gt;</span> des<span class="token operator">-</span>ede3<span class="token punctuation">,</span>      <span class="token comment">// 3des加密</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">)</span>
</code></pre></div><p>其解密函数为 string openssl_encrypt ( string $data , string $method , string $password)
2. 非对称加密相关：</p> <blockquote><p>openssl_get_publickey();openssl_pkey_get_public();      // 从证书导出公匙；
openssl_get_privatekey();openssl_pkey_get_private();    // 从证书导出私匙；
它们都只需要传入证书文件（一般是.pem文件）；
openssl_public_encrypt(string $data , string &amp;$crypted , mixed $key [, int $padding = OPENSSL_PKCS1_PADDING ] )
openssl_public_encrypt(string $data , string &amp;$crypted , mixed $key [, int $padding = OPENSSL_PKCS1_PADDING ] )</p></blockquote> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">openssl_private_encrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>；  <span class="token comment">// 使用私匙加密；</span>
<span class="token function">openssl_private_decrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>；  <span class="token comment">// 使用私匙解密；</span>
<span class="token function">openssl_public_decrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>；  <span class="token comment">// 使用公匙解密；</span>
</code></pre></div><ol start="3"><li>还有签名和验签函数：</li></ol> <blockquote><p>bool openssl_sign ( string $data , string &amp;$signature , mixed $priv_key_id [, mixed $signature_alg = OPENSSL_ALGO_SHA1 ] )
int openssl_verify ( string $data , string $signature , mixed $pub_key_id [, mixed $signature_alg = OPENSSL_ALGO_SHA1 ] )
签名函数：$data为要签名的数据；$signature为签名结果的引用变量；$priv_key_id为签名所使用的私匙;$signature_alg为签名要使用的算法，其算法列表可以使用openssl_get_md_methods ()得到，形如：</p></blockquote> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">array</span><span class="token punctuation">(</span>
    <span class="token number">0</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token constant">MD5</span><span class="token punctuation">,</span>
    <span class="token number">1</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token constant">SHA1</span><span class="token punctuation">,</span>
    <span class="token number">2</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token constant">SHA256</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span>
</code></pre></div><p>验签函数：与签名函数相对，只不过它要传入与私匙对应的公匙；其结果为签名验证结果，1为成功，0为失败，-1则表示错误；</p> <h2 id="结束语"><a href="#结束语" aria-hidden="true" class="header-anchor">#</a> 结束语</h2> <p>密码学是一个十分高深的学科，它理论艰深，概念繁多，作为一个WEB开发人员，虽然不需要我们去研究其底层实现，但是学会使用封装好的方法很有利于我们开发。甚至了解其基本实现，也可以触类旁通，对算法等有新的理解。</p> <h2 id="demo"><a href="#demo" aria-hidden="true" class="header-anchor">#</a> demo</h2> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">/**
 * 使用openssl基于rsa实现的非对称加密
 * date 2018-1-31 zx
 */</span>
<span class="token keyword">class</span> <span class="token class-name">Sll_encrypt</span>
<span class="token punctuation">{</span>
    <span class="token comment">//私钥</span>
    <span class="token keyword">private</span> <span class="token variable">$_privKey</span><span class="token punctuation">;</span>
    <span class="token comment">//公钥</span>
    <span class="token keyword">private</span> <span class="token variable">$_pubKey</span><span class="token punctuation">;</span>
    <span class="token comment">//密钥位置</span>
    <span class="token keyword">private</span> <span class="token variable">$_keyPath</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 指定密钥文件地址
     * 
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'请指定密钥文件地址目录'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_keyPath</span> <span class="token operator">=</span> <span class="token variable">$path</span><span class="token punctuation">;</span>
        self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">iniSetting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 创建公钥和私钥
     * 
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">createKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$config</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token double-quoted-string string">&quot;config&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token constant">DIR_CONFIG</span><span class="token punctuation">.</span><span class="token single-quoted-string string">'rsa.cnf'</span><span class="token punctuation">,</span> <span class="token comment">//文件位置</span>
            <span class="token double-quoted-string string">&quot;digest_alg&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token double-quoted-string string">&quot;sha512&quot;</span><span class="token punctuation">,</span>
            <span class="token double-quoted-string string">&quot;private_key_bits&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">4096</span><span class="token punctuation">,</span>
            <span class="token double-quoted-string string">&quot;private_key_type&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token constant">OPENSSL_KEYTYPE_RSA</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 生成私钥</span>
        <span class="token variable">$rsa</span> <span class="token operator">=</span> <span class="token function">openssl_pkey_new</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">openssl_pkey_export</span><span class="token punctuation">(</span><span class="token variable">$rsa</span><span class="token punctuation">,</span> <span class="token variable">$privKey</span><span class="token punctuation">,</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> <span class="token variable">$config</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_keyPath</span> <span class="token punctuation">.</span> <span class="token constant">DIRECTORY_SEPARATOR</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">'priv.key'</span><span class="token punctuation">,</span> <span class="token variable">$privKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_privKey</span> <span class="token operator">=</span> <span class="token function">openssl_pkey_get_public</span><span class="token punctuation">(</span><span class="token variable">$privKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 生成公钥</span>
        <span class="token variable">$rsaPri</span> <span class="token operator">=</span> <span class="token function">openssl_pkey_get_details</span><span class="token punctuation">(</span><span class="token variable">$rsa</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$pubKey</span> <span class="token operator">=</span> <span class="token variable">$rsaPri</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_keyPath</span> <span class="token punctuation">.</span> <span class="token constant">DIRECTORY_SEPARATOR</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">'pub.key'</span><span class="token punctuation">,</span> <span class="token variable">$pubKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_pubKey</span> <span class="token operator">=</span> <span class="token function">openssl_pkey_get_public</span><span class="token punctuation">(</span><span class="token variable">$pubKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 设置私钥
     * 
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">setupPrivKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_resource</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_privKey</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_keyPath</span> <span class="token punctuation">.</span> <span class="token constant">DIRECTORY_SEPARATOR</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">'priv.key'</span><span class="token punctuation">;</span>
        <span class="token variable">$privKey</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_privKey</span> <span class="token operator">=</span> <span class="token function">openssl_pkey_get_private</span><span class="token punctuation">(</span><span class="token variable">$privKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 设置公钥
     * 
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">setupPubKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_resource</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_pubKey</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_keyPath</span> <span class="token punctuation">.</span> <span class="token constant">DIRECTORY_SEPARATOR</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">'pub.key'</span><span class="token punctuation">;</span>
        <span class="token variable">$pubKey</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_pubKey</span> <span class="token operator">=</span> <span class="token function">openssl_pkey_get_public</span><span class="token punctuation">(</span><span class="token variable">$pubKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 初始化配置
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">iniSetting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$privFile</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_keyPath</span> <span class="token punctuation">.</span> <span class="token constant">DIRECTORY_SEPARATOR</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">'priv.key'</span><span class="token punctuation">;</span>
        <span class="token variable">$pubFile</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_keyPath</span> <span class="token punctuation">.</span> <span class="token constant">DIRECTORY_SEPARATOR</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">'pub.key'</span><span class="token punctuation">;</span>
        <span class="token variable">$bool1</span> <span class="token operator">=</span> <span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$privFile</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$bool2</span> <span class="token operator">=</span> <span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$pubFile</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$bool1</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token variable">$bool2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">createKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建密钥   </span>
        <span class="token punctuation">}</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_privKey</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$privFile</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_pubKey</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$pubFile</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 获取公钥
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_pubKey</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 获取私钥
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getPrivateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_pubKey</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 用私钥加密
     * 
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">privEncrypt</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setupPrivKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">openssl_private_encrypt</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$encrypted</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_privKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$encrypted</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 私钥解密
     * 
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">privDecrypt</span><span class="token punctuation">(</span><span class="token variable">$encrypted</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$encrypted</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setupPrivKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$encrypted</span> <span class="token operator">=</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$encrypted</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">openssl_private_decrypt</span><span class="token punctuation">(</span><span class="token variable">$encrypted</span><span class="token punctuation">,</span> <span class="token variable">$decrypted</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_privKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$decrypted</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 公钥加密
     * 
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">pubEncrypt</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setupPubKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">openssl_public_encrypt</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$encrypted</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_pubKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$encrypted</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 公钥解密
     * 
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">pubDecrypt</span><span class="token punctuation">(</span><span class="token variable">$crypted</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$crypted</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setupPubKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$crypted</span> <span class="token operator">=</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$crypted</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">openssl_public_decrypt</span><span class="token punctuation">(</span><span class="token variable">$crypted</span><span class="token punctuation">,</span> <span class="token variable">$decrypted</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_pubKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$decrypted</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * __destruct
     * 
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">unset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_privKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">unset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">_pubKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


以简单的用户登录为例子说明类的用法：
<span class="token comment">//需要引入的js文件</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token double-quoted-string string">&quot;text/javascript&quot;</span> src<span class="token operator">=</span><span class="token double-quoted-string string">&quot;jsencrypt.min&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token comment">//提交登陆表单</span>

$<span class="token punctuation">(</span><span class="token single-quoted-string string">'#submit'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token keyword">var</span> userName <span class="token operator">=</span> $<span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;#input-username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> passWord <span class="token operator">=</span> $<span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;#input-password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> encrypt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSEncrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> publickey <span class="token operator">=</span>&quot;<span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token variable">$publicKey</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span>&quot;;

encrypt.setPublicKey(publickey);

userName = encrypt.encrypt(userName);

passWord = encrypt.encrypt(passWord);

var form = $('<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>');

form.attr('action', &quot;<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">htmlspecialchars_decode</span><span class="token punctuation">(</span><span class="token variable">$action</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>&quot;);

form.attr('method', 'post');

var userName_input = $('<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>');

userName_input.attr('value',userName);

form.append(userName_input);

var password_input = $('<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>');

password_input.attr('value',passWord);

form.append(password_input);

form.appendTo('body').submit();

Loginanimation(e);

return false;

});
/后端代码书写方式，需要拼凑出符合形式的key值

//基于rsa非对称加密
  $path = DIR_CONFIG.'rsa.cnf'; //DIR_CONFIG 目录常量，用于存放秘钥的文件
  $rsa = new Sll_encrypt($path);
  $publicKeys = explode(PHP_EOL,$rsa-&gt;getPublicKey());
  $keyStrings = '';
  for($i=0;$i&lt;count($publicKeys)-2;$i++){
  $keyStrings .= $publicKeys[$i].&quot;\\&quot;.PHP_EOL;
  }
  $keyStrings .= $publicKeys[$i]; //  //传给前段的公钥

后端接受到数据
$username = $_POST['username'];
$password = $_POST['password'];
$username = $rsa-&gt;privDecrypt($username);
$password = $rsa-&gt;privDecrypt($password);
</code></pre></div><div class="danger custom-block"><p class="custom-block-title">WARNING</p> <p>本文作者：zane<br>
版权声明：本博客所有文章除特别声明外，均采用 CC BY-NC-SA 3.0 许可协议。转载请注明出处！</p></div></div> <!----> <div class="content page-nav"><p class="inner"><span class="prev">
          ← <a href="/blog/PHP%E9%94%99%E8%AF%AF%E6%8A%91%E5%88%B6%E7%AC%A6%E5%AF%BC%E8%87%B4%E5%BC%95%E7%94%A8%E4%BC%A0%E9%80%92%E5%A4%B1%E6%95%88%E7%9A%84%E9%97%AE%E9%A2%98.html" class="prev">
            PHP错误抑制符导致引用传递失效的问题
          </a></span> <span class="next"><a href="/blog/SQL%E6%B3%A8%E5%85%A5.html">
            SQL注入
          </a> →
        </span></p></div></div> <div id="comment-container"><div class="gt-container"><div class="gt-initing"><i class="gt-loader"></i> <p class="gt-initing-text">Gitalking ...</p></div> <!----> <!----> <div><div class="gt-header"><a class="gt-avatar-github"><span class="gt-ico gt-ico-github"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M64 524C64 719.602 189.356 885.926 364.113 947.017 387.65799 953 384 936.115 384 924.767L384 847.107C248.118 863.007 242.674 773.052 233.5 758.001 215 726.501 171.5 718.501 184.5 703.501 215.5 687.501 247 707.501 283.5 761.501 309.956 800.642 361.366 794.075 387.658 787.497 393.403 763.997 405.637 743.042 422.353 726.638 281.774 701.609 223 615.67 223 513.5 223 464.053 239.322 418.406 271.465 381.627 251.142 320.928 273.421 269.19 276.337 261.415 334.458 256.131 394.888 302.993 399.549 306.685 432.663 297.835 470.341 293 512.5 293 554.924 293 592.81 297.896 626.075 306.853 637.426 298.219 693.46 258.054 747.5 262.966 750.382 270.652 772.185 321.292 753.058 381.083 785.516 417.956 802 463.809 802 513.5 802 615.874 742.99 701.953 601.803 726.786 625.381 750.003 640 782.295 640 818.008L640 930.653C640.752 939.626 640 948.664978 655.086 948.665 832.344 888.962 960 721.389 960 524 960 276.576 759.424 76 512 76 264.577 76 64 276.576 64 524Z"></path>
</svg>
</span> <!----></span></a> <div class="gt-header-comment"><textarea placeholder="Leave a comment" class="gt-header-textarea"></textarea> <div class="gt-header-preview markdown-body hide"></div> <div class="gt-header-controls"><a href="https://guides.github.com/features/mastering-markdown/" target="_blank" class="gt-header-controls-tip"><span class="gt-ico gt-ico-tip"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M512 366.949535c-16.065554 0-29.982212 13.405016-29.982212 29.879884l0 359.070251c0 16.167882 13.405016 29.879884 29.982212 29.879884 15.963226 0 29.879884-13.405016 29.879884-29.879884L541.879884 396.829419C541.879884 380.763865 528.474868 366.949535 512 366.949535L512 366.949535z"
    p-id="3083"></path>
  <path d="M482.017788 287.645048c0-7.776956 3.274508-15.553912 8.80024-21.181973 5.525732-5.525732 13.302688-8.80024 21.181973-8.80024 7.776956 0 15.553912 3.274508 21.079644 8.80024 5.525732 5.62806 8.80024 13.405016 8.80024 21.181973 0 7.776956-3.274508 15.656241-8.80024 21.181973-5.525732 5.525732-13.405016 8.697911-21.079644 8.697911-7.879285 0-15.656241-3.274508-21.181973-8.697911C485.292295 303.301289 482.017788 295.524333 482.017788 287.645048L482.017788 287.645048z"
    p-id="3084"></path>
  <path d="M512 946.844409c-239.8577 0-434.895573-195.037873-434.895573-434.895573 0-239.8577 195.037873-434.895573 434.895573-434.895573 239.755371 0 434.895573 195.037873 434.895573 434.895573C946.895573 751.806535 751.755371 946.844409 512 946.844409zM512 126.17088c-212.740682 0-385.880284 173.037274-385.880284 385.777955 0 212.740682 173.037274 385.777955 385.880284 385.777955 212.740682 0 385.777955-173.037274 385.777955-385.777955C897.777955 299.208154 724.740682 126.17088 512 126.17088z"
    p-id="3085"></path>
</svg>
</span> <span class="gt-ico-text">Markdown is supported</span></span></a> <!----> <button class="gt-btn gt-btn-preview"><span class="gt-btn-text">Preview</span> <!----></button> <button class="gt-btn gt-btn-login"><span class="gt-btn-text">Login with GitHub</span> <!----></button></div></div></div> <div class="gt-comments"><span></span> <p class="gt-comments-null">
                Be the first guy leaving a comment!
            </p> <!----></div></div></div></div></div> <!----></div> <div class="tool-group"><!----></div></div> <!----></div> <div class="background-mask" style="background:url(&quot;#e6ecf0&quot;) no-repeat fixed;"></div></div></div>
    <script src="/assets/js/8.85014434.js" defer></script><script src="/assets/js/app.5f87c6e8.js" defer></script>
  </body>
</html>
